@{
    Layout = "~/Areas/EmpresasPage/Views/Shared/_Layout.cshtml";
}


<link href="~/Assets/plugins/chosen/chosen.min.css" rel="stylesheet">

<link href="~/Assets/plugins/magic-check/css/magic-check.min.css" rel="stylesheet">
<link href="~/Assets/plugins/chosen/chosen.min.css" rel="stylesheet">

<h1 id="titulo">Cartera Empresas</h1>
<div id="page-content">
    <div class="row">
        <div class="panel" style="border-radius: 6px;">
            <div class="panel-heading">
                <h2 class="panel-title">Empresas Asignadas</h2>
            </div>

            <div class="panel-body">
                <table id="tabla" class="table table-hover table-vcenter">
                    <thead>
                        <tr>
                            <th>Rut Empresa</th>
                            <th>Nombre Empresa</th>
                            <th>N° Trabajadores</th>
                            <th>Holding</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="bdy_datos"></tbody>
                </table>
            </div>
        </div>
    </div>


    @*<a href="#popover" class="demo-psi-male icon-lg add-popover" data-original-title="Ejecutivos Asignados" data-content="its so simple to create a tooltop for my website!" data-placement="top" data-trigger="focus" data-toggle="popover"></a>*@

</div>


@section script{

    <script src="~/Assets/plugins/chosen/chosen.jquery.min.js"></script>


    <script type="text/javascript">

        $(function () {
             $("#tabla").bootstrapTable({
                 striped: true,
                 pagination: true,
                 pageSize: 10,
                 pageList: [],
                 search: true,
                 showColumns: false,
                 showRefresh: true,
             });
            $("#titulo").css('font-size', '27px').css('color', '#b3b3b3').css('margin-left', '20px')
            cargador.CargaDatosCateraAgente();

        });


        var cargador = {
            CargaDatosCateraAgente: function () {
                $("#bdy_datos").html("");
                $.SecGetJSON(BASE_URL + "/motor/api/perfil-empresas/obtener-cartera-agente", function (menus) {
                    var iterador = ""
                    $.each(menus, function (i, e) {
                        var NomHolding = ""
                        var Asignados = "";
                        var Anexo = "";
                        var contador = 0;
                        var validador = 0;
                        if (e.Holding == 0 || e.NombreHolding =="") {
                            NomHolding = $('<div>').addClass('label label-table label-warning').append('Sin Holding')
                        }
                        else {
                            NomHolding = $('<div>').addClass('label label-table label-success').append(e.NombreHolding)
                        }
                        $.SecGetJSON(BASE_URL + "/motor/api/perfil-empresas/lista-ejecutivo-asignado", { IdEmpresa: e.Id }, function (result) {

                            $.each(result, function (ix, ex) {
                                Asignados = '<a href="#popover" class="demo-psi-male icon-lg add-popover" data-original-title="Ejecutivos Asignados" data-content="its so simple to create a tooltop for my website!" data-placement="top" data-trigger="focus" data-toggle="popover"></a>'
                                validador = 1
                            });
                        });
                        $.SecGetJSON(BASE_URL + "/motor/api/perfil-empresas/lista-contador-anexos", { RutEmpresa: e.RutEmpresa }, function (respuesta) {
                            contador = respuesta.TotalAnexos;
                            if (contador > 0) { validador = 2 }
                            Anexo = '<a href="#" data-toggle="dropdown" class="dropdown-toggle" aria-expanded="true"><i class="ion-clipboard" style="font-size: 22px;"></i><span class="badge badge-header badge-danger" style="position: unset;">' + contador + '</span></a>'
                            if (contador == 0) { Anexo = "" }

                            $("#bdy_datos")
                                .append($("<tr>")
                                    .append($("<td>").append(e.RutEmpresa))
                                    .append($("<td>").append('<a href="' + BASE_URL + '/motor/Emp/FichaEmpresa?rutEmp=' + e.RutEmpresa + '&validador=' + validador + '&Id=' + e.Id + ' " class="btn-link text-semibold" style="font-weight: 400;">' + e.NombreEmpresa + '</a>'))
                                    .append($("<td>").append(e.NTrabajador))
                                    .append($("<td>").append(NomHolding))
                                    .append($("<td>").append(Asignados))
                                    .append($("<td>").append(Anexo))
                                )
                        });

                    });
                    $("#tabla").bootstrapTable({
                        striped: true,
                        pagination: true,
                        pageSize: 10,
                        pageList: [],
                        search: true,
                        showColumns: false,
                        showRefresh: true,
                    });
                });
            }
        }

    </script>

}
